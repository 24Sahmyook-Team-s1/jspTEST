<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="css/MainPage.css" />
    <script src="js/jquery-3.6.0.min.js"></script>	
    <script src="js/core.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>MOLE</h1>
    </div>
    <div class="ongoing-projects">
      <div class="ongoing-header">
        <h2>On Going</h2>
         <button id="addProjectBtn" class="add-project-btn">í”„ë¡œì íŠ¸ ì¶”ê°€</button>
      </div>
      <div class="scroll-container">
        <div class="project-list-wrapper">
          <div class="project-list" id="projectList">
            <!-- JavaScriptë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
          </div>
        </div>
      </div>
    </div>

    <div class="recent-and-gantt">
      <div class="box-col">
        <h2 class="title">Recent Issue</h2>
        <div class="recent-issue-container">
          <div class="recent-issues">
            <div class="issue">issue: something on svelte</div>
            <div class="issue">issue: something on svelte</div>
            <div class="issue">issue: something on svelte</div>

          </div>
        </div>
      </div>

      <div class="gantt-chart-container">
        <h2 class="title">Gantt Chart</h2>
        <div class="gantt-chart">
          <div class="gantt-header">
            <div class="gantt-project-name">Project</div>
            <div class="gantt-days">
              <div>ì›”</div>
              <div>í™”</div>
              <div>ìˆ˜</div>
              <div>ëª©</div>
              <div>ê¸ˆ</div>

            </div>
          </div>
          <div class="gantt-body" id="ganttBody">
            <!-- JavaScriptë¡œ í”„ë¡œì íŠ¸ì™€ ì§„í–‰ë„ë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
          </div>
        </div>
      </div>
    </div>

    <div class="profile-container">
	    <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
	    <div class="profile-menu" id="profileMenu">
	        <ul>
				<li data-link="MainPage.html">í™ˆ</li>
				<li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li> <!-- âœ… íŒ€ í˜ì´ì§€ ì¶”ê°€ -->
				<li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
				<li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
	            <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
	            <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
				<li data-link="SettingsPage.html">ì„¤ì •</li> </ul>
	    </div>
	</div>
	
	<!-- í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ ì°½ -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <img src="public/logo-transparent.png" alt="MOLE Logo" class="modal-logo">
            <h2>ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</h2>

            <label for="projectName">í”„ë¡œì íŠ¸ ì´ë¦„</label>
            <input type="text" id="projectName" placeholder="í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥">

            <label for="projectDesc">í”„ë¡œì íŠ¸ ì„¤ëª…</label>
            <input type="text" id="projectDesc" placeholder="í”„ë¡œì íŠ¸ ì„¤ëª…ì„ ì…ë ¥">

            <label for="projectOwner">í”„ë¡œì íŠ¸ ì†Œìœ ì</label>
            <input type="text" id="projectOwner" placeholder="í˜„ì¬ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“œëŠ” ìœ ì €ëª…">

            <button id="createProjectBtn">í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</button>
        </div>
    </div>
  </body>
</html>
<script>

document.addEventListener("DOMContentLoaded", function () {
    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");

    profileBtn.addEventListener("click", function () {
        profileMenu.classList.toggle("active"); // ë©”ë‰´ í† ê¸€
    });

    document.addEventListener("click", function (event) {
        if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
            profileMenu.classList.remove("active"); // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        }
    });

    // âœ… í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
    window.goToPage = function (page) {
        window.location.href = page;
    };
});
$(document).ready(function () {
    loadProjects(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í”„ë¡œì íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°


    const projectWrapper = $(".project-list-wrapper");
    const loadMoreBtn = $("#loadMoreBtn");

    let loadedCount = 4; // ì´ˆê¸° í‘œì‹œ ê°œìˆ˜
    let allProjects = []; // ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥

    // âœ… í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ On Goingê³¼ Gantt Chartì— ë°˜ì˜
    function loadProjects() {
        $.ajax({
            url: "jsp/GetProjectList.jsp",
            type: "GET",
            dataType: "json",
            success: function (projects) {
                console.log("âœ… í”„ë¡œì íŠ¸ ë°ì´í„° ìˆ˜ì‹ :", projects);
                allProjects = projects; // ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥
                showProjects(loadedCount);
            },
            error: function (xhr, status, error) {
                console.error("âŒ AJAX ì˜¤ë¥˜ ë°œìƒ:", error);
            },
        });
    }

    // âœ… On Going í”„ë¡œì íŠ¸ ëª©ë¡ í‘œì‹œ
    function showProjects(count) {
        let projectContainer = $("#projectList");
        projectContainer.empty(); // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

        let displayProjects = allProjects.slice(0, count); // í˜„ì¬ í‘œì‹œí•  í”„ë¡œì íŠ¸ë§Œ ê°€ì ¸ì˜¤ê¸°

        if (displayProjects.length > 0) {
            displayProjects.forEach(project => {
                projectContainer.append(getProjectCode(project));
            });
        } else {
            projectContainer.append("<p>No On Going Projects</p>");
        }

        updateGanttChart(displayProjects); // âœ… ê°„íŠ¸ì°¨íŠ¸ë„ ê°™ì´ ì—…ë°ì´íŠ¸

        if (count >= allProjects.length) {
            loadMoreBtn.hide();
        }
    }

    // âœ… ê°„íŠ¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateGanttChart(projects) {
        let ganttBody = $("#ganttBody");
        ganttBody.empty();

        projects.forEach(project => {
            let row = `<div class="gantt-row">
                <div class="project-name">${project.name}</div>
                <div class="gantt-progress">
                    <div class="${project.schedule[0] ? 'active' : ''}"></div>
                    <div class="${project.schedule[1] ? 'active' : ''}"></div>
                    <div class="${project.schedule[2] ? 'active' : ''}"></div>
                    <div class="${project.schedule[3] ? 'active' : ''}"></div>
                    <div class="${project.schedule[4] ? 'active' : ''}"></div>
                </div>
            </div>`;
            ganttBody.append(row);
        });
    }

    loadMoreBtn.on("click", function () {
        loadedCount += 2;
        if (loadedCount > allProjects.length) {
            loadedCount = allProjects.length;
        }
        showProjects(loadedCount);
    });

    function getProjectCode(project) {
        return `
            <div class="project">
                <h3>${project.name}</h3>
                <p>ğŸ“… Created At: ${project.created_at}</p>
            </div>
        `;
    }
});
// ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
document.querySelectorAll('.profile-menu li').forEach(item => {
    item.addEventListener('click', function () {
        const targetPage = this.getAttribute('data-link');
        window.location.href = targetPage;

    });
  });

$(document).ready(function () {
    const addProjectBtn = $("#addProjectBtn");
    const projectModal = $("#projectModal");
    const createProjectBtn = $("#createProjectBtn");

    // í”„ë¡œì íŠ¸ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
    addProjectBtn.on("click", function () {
        projectModal.show();
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    $(window).on("click", function (event) {
        if ($(event.target).is(projectModal)) {
            projectModal.hide();
        }
    });

 // ğŸ“Œ í”„ë¡œì íŠ¸ ìƒì„± ë¡œì§ (ë‚ ì§œ ë° ì´ëª¨ì§€ ì¶”ê°€)
    createProjectBtn.on("click", function () {
        const projectName = $("#projectName").val();
        const projectDesc = $("#projectDesc").val();
        const projectOwner = $("#projectOwner").val();

        if (projectName && projectDesc && projectOwner) {
            const today = new Date().toISOString().split('T')[0];  // YYYY-MM-DD í˜•ì‹ì˜ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
            addProjectToPage(projectName, projectDesc, today);
            projectModal.hide();
            clearInputs();
        } else {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        }
    });

    // ğŸ“Œ On Goingê³¼ Gantt Chartì— í”„ë¡œì íŠ¸ ì¶”ê°€ (ë‚ ì§œ í¬í•¨)
    function addProjectToPage(name, desc, date) {
        $("#projectList").append(`
            <div class="project">
                <h3>${name}</h3>
                <p>ğŸ“… Created At: ${date}</p>
            </div>
        `);

        $("#ganttBody").append(`
            <div class="gantt-row">
                <div class="project-name">${name}</div>
                <div class="gantt-progress">
                    <div></div><div></div><div></div><div></div><div></div>
                </div>
            </div>
        `);
    }


    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    function clearInputs() {
        $("#projectName").val('');
        $("#projectDesc").val('');
        $("#projectOwner").val('');
    }
});

</script>
