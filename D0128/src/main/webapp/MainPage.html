<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="css/MainPage.css" />
    <script src="js/jquery-3.6.0.min.js"></script>	
    <script src="js/core.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>MOLE</h1>
    </div>
    <div class="ongoing-projects">
      <div class="ongoing-header">
        <h2>On Going</h2>
        <button id="addProjectBtn" class="add-project-btn">í”„ë¡œì íŠ¸ ì¶”ê°€</button>
      </div>
      <div class="scroll-container">
        <div class="project-list-wrapper">
          <div class="project-list" id="projectList">
            <!-- JavaScriptë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
          </div>
        </div>
      </div>
    </div>

    <div class="recent-and-gantt">
      <div class="box-col">
        <h2 class="title">Recent Issue</h2>
        <div class="recent-issue-container">
          <div class="recent-issues">
            <div class="issue">issue: something on svelte</div>
            <div class="issue">issue: something on svelte</div>
            <div class="issue">issue: something on svelte</div>
          </div>
        </div>
      </div>

      <div class="gantt-chart-container">
        <h2 class="title">Gantt Chart</h2>
        <div class="gantt-chart">
          <div class="gantt-header">
            <div class="gantt-project-name">Project</div>
            <div class="gantt-days">
              <div>ì›”</div>
              <div>í™”</div>
              <div>ìˆ˜</div>
              <div>ëª©</div>
              <div>ê¸ˆ</div>
            </div>
          </div>
          <div class="gantt-body" id="ganttBody">
            <!-- JavaScriptë¡œ í”„ë¡œì íŠ¸ì™€ ì§„í–‰ë„ë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
          </div>
        </div>
      </div>
    </div>

    <div class="profile-container">
      <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
      <div class="profile-menu" id="profileMenu">
        <ul>
          <li data-link="MainPage.html">í™ˆ</li>
          <li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
          <li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
          <li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
          <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
          <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
          <li data-link="SettingsPage.html">ì„¤ì •</li>
        </ul>
      </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ ì°½ -->
    <div id="projectModal" class="modal">
      <div class="modal-content">
        <img src="public/logo-transparent.png" alt="MOLE Logo" class="modal-logo">
        <h2>ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</h2>

        <label for="projectName">í”„ë¡œì íŠ¸ ì´ë¦„</label>
        <input type="text" id="projectName" placeholder="í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥">

        <label for="projectOwner">í”„ë¡œì íŠ¸ ì†Œìœ ì</label>
        <input type="text" id="projectOwner" placeholder="í˜„ì¬ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“œëŠ” ìœ ì €ëª…">

        <button id="createProjectBtn">í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</button>
      </div>
    </div>

    <script>
    
    $(document).ready(function () {
      loadProjects(); 
		
      $(".sidebar-link, .profile-menu li").on("click", function () {
          const targetPage = $(this).data("link");
          window.location.href = targetPage;
      });

      // ğŸ“Œ í”„ë¡œí•„ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ë‰´ í† ê¸€
      const profileBtn = $("#profileBtn");
      const profileMenu = $("#profileMenu");

      profileBtn.on("click", function (event) {
          event.stopPropagation();
          profileMenu.toggleClass("active");
      });

      $(document).on("click", function (event) {
          if (!profileBtn.is(event.target) && !profileMenu.is(event.target) && profileMenu.has(event.target).length === 0) {
              profileMenu.removeClass("active");
          }
      });
      const projectWrapper = $(".project-list-wrapper");

      function loadProjects() {
        $.ajax({
          url: "jsp/GetProjectList.jsp",
          type: "GET",
          dataType: "json",
          success: function (projects) {
            console.log("âœ… í”„ë¡œì íŠ¸ ë°ì´í„° ìˆ˜ì‹ :", projects);
            showProjects(projects);
          },
          error: function (xhr, status, error) {
            console.error("âŒ AJAX ì˜¤ë¥˜ ë°œìƒ:", error);
          },
        });
      }

      function showProjects(projects) {
        let projectContainer = $("#projectList");
        projectContainer.empty();

        if (projects.length > 0) {
          projects.forEach(project => {
            projectContainer.append(getProjectCode(project));
          });
        } else {
          projectContainer.append("<p>No On Going Projects</p>");
        }

        updateGanttChart(projects);
      }

      function updateGanttChart(projects) {
        let ganttBody = $("#ganttBody");
        ganttBody.empty();

        projects.forEach(project => {
          let row = `<div class="gantt-row">
            <div class="project-name">${project.name}</div>
            <div class="gantt-progress">
              <div class="${project.schedule[0] ? 'active' : ''}"></div>
              <div class="${project.schedule[1] ? 'active' : ''}"></div>
              <div class="${project.schedule[2] ? 'active' : ''}"></div>
              <div class="${project.schedule[3] ? 'active' : ''}"></div>
              <div class="${project.schedule[4] ? 'active' : ''}"></div>
            </div>
          </div>`;
          ganttBody.append(row);
        });
      }

      function getProjectCode(project) {
        return `
          <div class="project">
            <h3>${project.name}</h3>
            <p>ğŸ“… Created At: ${project.createdAt}</p>
          </div>
        `;
      }

      $("#addProjectBtn").on("click", function () {
        $("#projectModal").show();
      });

      $(window).on("click", function (event) {
        if ($(event.target).is("#projectModal")) {
          $("#projectModal").hide();
        }
      });

      $("#createProjectBtn").on("click", function () {
        const projectName = $("#projectName").val();
        const projectOwner = $("#projectOwner").val();

        if (projectName && projectOwner) {
          $.ajax({
            url: "jsp/AddProject.jsp",
            type: "POST",
            data: {
              projectName: projectName,
              adminUserID: projectOwner
            },
            success: function(response) {
              alert("í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
              location.reload();
            },
            error: function(xhr, status, error) {
              console.error("í”„ë¡œì íŠ¸ ì¶”ê°€ ì‹¤íŒ¨:", error);
              alert("í”„ë¡œì íŠ¸ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
          });
          $("#projectModal").hide();
          clearInputs();
        } else {
          alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        }
      });

      function clearInputs() {
        $("#projectName").val('');
        $("#projectOwner").val('');
      }
    });
    </script>
  </body>
</html>
