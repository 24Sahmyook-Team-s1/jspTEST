<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="css/MainPage.css" />

    <script src="js/jquery-3.6.0.min.js"></script>	
	<script src="js/core.js"></script>
	</head>
  <body>
    <div class="header">
      <h1>MOLE</h1>
    </div>

    <div class="main-container">
      <div class="ongoing-projects">
    <h2>On Going</h2>
    <div >
	    <div class="scroll-container">
	        <button class="scroll-btn left">&lt;</button> <!-- ì™¼ìª½ ì´ë™ ë²„íŠ¼ -->
	        <div class="project-list-wrapper">
	            <div class="project-list"></div> <!-- í”„ë¡œì íŠ¸ê°€ ì—¬ê¸°ì— ë¡œë“œë¨ -->
	        </div>
	        <button class="scroll-btn right">&gt;</button> <!-- ì˜¤ë¥¸ìª½ ì´ë™ ë²„íŠ¼ -->
	    </div>
    </div>
</div>

      <div>
        <div class="recent-and-gantt">
          <div class="box-col">
            <h2 class="title">recent issue</h2>
            <div class="recent-issue-container">
              <div class="recent-issues">
                <div class="issue">issue: something on svelte</div>
                <div class="issue">issue: something on svelte</div>
                <div class="issue">issue: something on svelte</div>
              </div>
            </div>
          </div>

          <div class="box-col">
            <h2 class="title">Gantt Chart</h2>
            <div class="gantt-chart-container">
              <div class="chart">
                <div>Example Block A</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
$(document).ready(function () {
    loadProjects(); // íŽ˜ì´ì§€ ë¡œë“œ ì‹œ í”„ë¡œì íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°

    const projectWrapper = $(".project-list-wrapper");

    // ì´ˆê¸°ì— ìŠ¤í¬ë¡¤ì„ ë§¨ ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ê°•ì œ ì ìš©)
    setTimeout(() => {
        projectWrapper.scrollLeft(0);
    }, 200);

    // ë§ˆìš°ìŠ¤ë¡œ ë“œëž˜ê·¸í•˜ì—¬ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
    let isDown = false;
    let startX;
    let scrollLeft;

    projectWrapper.on("mousedown", function (e) {
        isDown = true;
        projectWrapper.addClass("active");
        startX = e.pageX - projectWrapper.offset().left;
        scrollLeft = projectWrapper.scrollLeft();
    });

    projectWrapper.on("mouseleave mouseup", function () {
        isDown = false;
        projectWrapper.removeClass("active");
    });

    projectWrapper.on("mousemove", function (e) {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - projectWrapper.offset().left;
        const walk = (x - startX) * 2;
        projectWrapper.scrollLeft(scrollLeft - walk);
    });
});

function loadProjects() {
    $.ajax({
        url: "jsp/GetProjectList.jsp",
        type: "GET",
        dataType: "json",
        success: function (projects) {
            console.log("âœ… í”„ë¡œì íŠ¸ ë°ì´í„° ìˆ˜ì‹ :", projects);
            showProjects(projects);
        },
        error: function (xhr, status, error) {
            console.error("âŒ AJAX ì˜¤ë¥˜ ë°œìƒ:", error);
        },
    });
}

function showProjects(projects) {
    var projectContainer = $(".project-list");
    projectContainer.empty(); // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

    if (projects.length > 0) {
        for (var i = 0; i < projects.length; i++) {
            projectContainer.append(getProjectCode(projects[i]));
        }
    } else {
        projectContainer.append("<p>No On Going Projects</p>");
    }

    // **ë¦¬ìŠ¤íŠ¸ ë¡œë“œ í›„ ìŠ¤í¬ë¡¤ì„ ê°•ì œë¡œ ì´ˆê¸°í™”**
    setTimeout(() => {
        $(".project-list-wrapper").scrollLeft(0);
    }, 200);
}

function getProjectCode(project) {
    return `
        <div class="project">
            <h3>${project.name}</h3>
            <p>ðŸ“… Created At: ${project.created_at}</p>
        </div>
    `;
}

</script>
