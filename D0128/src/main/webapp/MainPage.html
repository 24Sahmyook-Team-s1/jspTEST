<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="css/MainPage.css" />

    <script src="js/jquery-3.6.0.min.js"></script>	
	<script src="js/core.js"></script>
	</head>
  <body>
    <div class="header">
      <h1>MOLE</h1>
    </div>

    <div class="ongoing-projects">
    <div class="ongoing-header">
        <h2>On Going</h2>
        <button id="loadMoreBtn" class="load-more-btn">ë”ë³´ê¸°</button>
    </div>
    <div class="scroll-container">
        <div class="project-list-wrapper">
            <div class="project-list" id="projectList">
	                <!-- JavaScriptë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
	            </div>
	        </div>
	    </div>
	</div>


      <div>
        <div class="recent-and-gantt">
          <div class="box-col">
            <h2 class="title">recent issue</h2>
            <div class="recent-issue-container">
              <div class="recent-issues">
                <div class="issue">issue: something on svelte</div>
                <div class="issue">issue: something on svelte</div>
                <div class="issue">issue: something on svelte</div>
              </div>
            </div>
          </div>

          <div class="box-col">
            <h2 class="title">Gantt Chart</h2>
            <div class="gantt-chart-container">
              <div class="chart">
                <div>Example Block A</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="profile-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
                <li>í™ˆ</li>
                <li>íŒ€</li>
                <li>í”„ë¡œí•„</li>
                <li>ì„¤ì •</li>
            </ul>
        </div>
    </div>
    
  </body>
</html>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const projectWrapper = document.querySelector(".project-list-wrapper");
    if (projectWrapper) {
        setTimeout(() => {
            projectWrapper.scrollLeft = 0; // ì²« ë²ˆì§¸ ë°•ìŠ¤ê°€ í•­ìƒ ë³´ì´ë„ë¡ ì„¤ì •
        }, 100);
    }
});

$(document).ready(function () {
    loadProjects(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í”„ë¡œì íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°

    const projectWrapper = $(".project-list-wrapper");
    const loadMoreBtn = $("#loadMoreBtn");
    
    let loadedCount = 4; // ì´ˆê¸° í‘œì‹œ ê°œìˆ˜
    let allProjects = []; // ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥

    // ì´ˆê¸°ì— ìŠ¤í¬ë¡¤ì„ ë§¨ ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ê°•ì œ ì ìš©)
    setTimeout(() => {
        projectWrapper.scrollLeft(0);
    }, 200);

    // ë§ˆìš°ìŠ¤ë¡œ ë“œë˜ê·¸í•˜ì—¬ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
    let isDown = false;
    let startX;
    let scrollLeft;

    projectWrapper.on("mousedown", function (e) {
        isDown = true;
        projectWrapper.addClass("active");
        startX = e.pageX - projectWrapper.offset().left;
        scrollLeft = projectWrapper.scrollLeft();
    });

    projectWrapper.on("mouseleave mouseup", function () {
        isDown = false;
        projectWrapper.removeClass("active");
    });

    projectWrapper.on("mousemove", function (e) {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - projectWrapper.offset().left;
        const walk = (x - startX) * 2;
        projectWrapper.scrollLeft(scrollLeft - walk);
    });

    // í”„ë¡œì íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadProjects() {
        $.ajax({
            url: "jsp/GetProjectList.jsp",
            type: "GET",
            dataType: "json",
            success: function (projects) {
                console.log("âœ… í”„ë¡œì íŠ¸ ë°ì´í„° ìˆ˜ì‹ :", projects);
                allProjects = projects; // ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥
                showProjects(loadedCount);
            },
            error: function (xhr, status, error) {
                console.error("âŒ AJAX ì˜¤ë¥˜ ë°œìƒ:", error);
            },
        });
    }

    // í”„ë¡œì íŠ¸ í‘œì‹œ í•¨ìˆ˜
    function showProjects(count) {
        let projectContainer = $("#projectList");
        projectContainer.empty(); // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

        let displayProjects = allProjects.slice(0, count); // í˜„ì¬ í‘œì‹œí•  í”„ë¡œì íŠ¸ë§Œ ê°€ì ¸ì˜¤ê¸°

        if (displayProjects.length > 0) {
            displayProjects.forEach(project => {
                projectContainer.append(getProjectCode(project));
            });
        } else {
            projectContainer.append("<p>No On Going Projects</p>");
        }

        // **ë¦¬ìŠ¤íŠ¸ ë¡œë“œ í›„ ìŠ¤í¬ë¡¤ì„ ê°•ì œë¡œ ì´ˆê¸°í™”**
        setTimeout(() => {
            $(".project-list-wrapper").scrollLeft(0);
        }, 200);

        // ëª¨ë“  í”„ë¡œì íŠ¸ê°€ ë¡œë“œë˜ë©´ ë²„íŠ¼ ìˆ¨ê¹€
        if (count >= allProjects.length) {
            loadMoreBtn.hide();
        }
    }

    // ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    loadMoreBtn.on("click", function () {
        loadedCount += 2; // 2ê°œì”© ì¶”ê°€
        if (loadedCount > allProjects.length) {
            loadedCount = allProjects.length;
        }
        showProjects(loadedCount);
    });

    // í”„ë¡œì íŠ¸ HTML ì½”ë“œ ìƒì„±
    function getProjectCode(project) {
        return `
            <div class="project">
                <h3>${project.name}</h3>
                <p>ğŸ“… Created At: ${project.created_at}</p>
            </div>
        `;
    }
});

document.addEventListener("DOMContentLoaded", function () {
    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");

    profileBtn.addEventListener("click", function () {
        // ë©”ë‰´ í† ê¸€ (ë³´ì˜€ë‹¤ê°€ ìˆ¨ê¸°ê¸°)
        profileMenu.classList.toggle("active");
    });

    // ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ë©”ë‰´ ë‹«ê¸°
    document.addEventListener("click", function (event) {
        if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
            profileMenu.classList.remove("active");
        }
    });
});


</script>
