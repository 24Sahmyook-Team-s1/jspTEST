<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOLE - ì´ìŠˆ ê´€ë¦¬</title>
    <link rel="stylesheet" href="css/IssuePage.css">
    <script src="js/jquery-3.6.0.min.js"></script>	
    <script src="js/core.js"></script>
</head>
<body>

    <!-- ìƒë‹¨ë°” -->
   <div class="header">
      <h2>MOLE</h2>
    </div>

    <div class="container">
      <!-- ğŸ“Œ ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <ul>
                <li class="sidebar-link" data-link="MainPage.html">ëŒ€ì‹œë³´ë“œ</li>
                <li class="sidebar-link" data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li class="sidebar-link" data-link="GanttChart.html">ê°„íŠ¸ ì°¨íŠ¸</li>
                <li class="sidebar-link" data-link="IssuePage.html">ì´ìŠˆ</li>
                <li class="sidebar-link" data-link="TeamBoard.html">íŒ€ ë³´ë“œ</li>
            </ul>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
          <h1>
			    <span>ìœ„í—˜ ê´€ë¦¬</span>
			    <div class="issue-buttons">
			        <button class="add-btn">ì´ìŠˆ ì¶”ê°€</button>
			        <button class="delete-btn">ì´ìŠˆ ì‚­ì œ</button>
			        <button class="update-btn">ì´ìŠˆ ì—…ë°ì´íŠ¸</button>
			    </div>
			</h1>

            <div class="issue-container">
                <!-- HAZARD -->
                <div class="issue-column hazard">
                    <h2>HAZARD âš ï¸</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="hazardList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>

                <!-- ISSUE -->
                <div class="issue-column issue">
                    <h2>ISSUE âš ï¸</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="issueList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>

                <!-- SOLVED -->
                <div class="issue-column solved">
                    <h2>SOLVED ğŸŸ¢</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="solvedList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ -->
    <div class="profile-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
                <li data-link="MainPage.html">í™ˆ</li>
                <li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
                <li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
                <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
                <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
                <li data-link="SettingsPage.html">ì„¤ì •</li>
            </ul>
        </div>
    </div>
    

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // ì‚¬ì´ë“œë°” í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function () {
            const targetPage = this.getAttribute('data-link');
            window.location.href = targetPage;
        });
    });
    
});

// ğŸ“Œ í”„ë¡œí•„ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ë‰´ í‘œì‹œ
const profileBtn = document.getElementById("profileBtn");
const profileMenu = document.getElementById("profileMenu");

profileBtn.addEventListener("click", function (event) {
    event.stopPropagation();
    profileMenu.classList.toggle("active");
});

document.addEventListener("click", function (event) {
    if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
        profileMenu.classList.remove("active");
    }
});


$(document).ready(function () {
    loadIssues(); 
    
    function loadIssues() {
        $.ajax({
            url: "jsp/projectIssueList.jsp",
            type: "POST", // GET â†’ POST ë³€ê²½
            data: { projectid: 1 }, // POSTë¡œ projectid ì „ë‹¬
            dataType: "json",
            success: function (issues) {
                console.log("âœ… Loaded issues:", issues);
                DisplayIssues(issues);
            },
            error: function (xhr, status, error) {
                console.error("âŒ AJAX ì˜¤ë¥˜ ë°œìƒ:", error);
            },
        });
    }

    function DisplayIssues(issues) {
		console.log("display");
        let hazardList = $("#hazardList");
        let issueList = $("#issueList");
        let solvedList = $("#solvedList");

        hazardList.empty();
        issueList.empty();
        solvedList.empty();

        issues.forEach(issue => {
			console.log(issue, " ", issue.level);
            if (issue.level === "0") {
                hazardList.append(getIssues(issue));
            } else if (issue.level === "1") {
                issueList.append(getIssues(issue));
            } else if (issue.level === "2") {
                solvedList.append(getIssues(issue));
            }
        });
    }
    
    function getIssues(issue) {
        return `
            <div class="issue-item">
                    <span>${issue.title}</span> - 
                    <span>${issue.description}</span>
            </div>
        `;
    }
});

</script>