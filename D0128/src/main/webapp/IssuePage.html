<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOLE - ì´ìŠˆ ê´€ë¦¬</title>
    <link rel="stylesheet" href="css/IssuePage.css">
</head>
<body>

    <!-- ìƒë‹¨ë°” -->
   <div class="header">
      <h2>MOLE</h2>
    </div>

    <div class="container">
      <!-- ğŸ“Œ ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <ul>
                <li class="sidebar-link" data-link="MainPage.html">ëŒ€ì‹œë³´ë“œ</li>
                <li class="sidebar-link" data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li class="sidebar-link" data-link="GanttChart.html">ê°„íŠ¸ ì°¨íŠ¸</li>
                <li class="sidebar-link" data-link="IssuePage.html">ì´ìŠˆ</li>
                <li class="sidebar-link" data-link="TeamBoard.html">íŒ€ ë³´ë“œ</li>
            </ul>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
          <h1>
			    <span>ìœ„í—˜ ê´€ë¦¬</span>
			    <div class="issue-buttons">
			        <button class="add-btn">ì´ìŠˆ ì¶”ê°€</button>
			        <button class="delete-btn">ì´ìŠˆ ì‚­ì œ</button>
			        <button class="update-btn">ì´ìŠˆ ì—…ë°ì´íŠ¸</button>
			    </div>
			</h1>

            <div class="issue-container">
                <!-- HAZARD -->
                <div class="issue-column hazard">
                    <h2>HAZARD âš ï¸</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="hazardList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>

                <!-- ISSUE -->
                <div class="issue-column issue">
                    <h2>ISSUE âš ï¸</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="issueList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>

                <!-- SOLVED -->
                <div class="issue-column solved">
                    <h2>SOLVED ğŸŸ¢</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="solvedList">
                        <!-- ì´ìŠˆ í•­ëª© ì¶”ê°€ ì˜ì—­ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ -->
    <div class="profile-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
                <li data-link="MainPage.html">í™ˆ</li>
                <li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
                <li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
                <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
                <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
                <li data-link="SettingsPage.html">ì„¤ì •</li>
            </ul>
        </div>
    </div>
    

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // ì‚¬ì´ë“œë°” í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function () {
            const targetPage = this.getAttribute('data-link');
            window.location.href = targetPage;
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
    fetchIssues();  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ìŠˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
});

function fetchIssues() {
    fetch('jsp/ProjectissueList.jsp', { method: 'POST' })  // ìˆ˜ì •ëœ ê²½ë¡œ
        .then(response => response.text())
        .then(data => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, 'text/html');
            const issues = doc.querySelectorAll('tbody tr');

            const hazardList = document.getElementById('hazardList');
            const issueList = document.getElementById('issueList');
            const solvedList = document.getElementById('solvedList');

            hazardList.innerHTML = '';
            issueList.innerHTML = '';
            solvedList.innerHTML = '';

            issues.forEach(issue => {
                const title = issue.children[3].innerText;
                const description = issue.children[4].innerText;

                const issueElement = document.createElement('p');
                issueElement.innerHTML = `<span>${title}</span><span>${description}</span>`;

                if (title.includes("HAZARD")) {
                    hazardList.appendChild(issueElement);
                } else if (title.includes("SOLVED")) {
                    solvedList.appendChild(issueElement);
                } else {
                    issueList.appendChild(issueElement);
                }
            });
        })
        .catch(error => {
            console.error('ì´ìŠˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        });
}



// ğŸ“Œ í”„ë¡œí•„ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ë‰´ í‘œì‹œ
const profileBtn = document.getElementById("profileBtn");
const profileMenu = document.getElementById("profileMenu");

profileBtn.addEventListener("click", function (event) {
    event.stopPropagation();
    profileMenu.classList.toggle("active");
});

document.addEventListener("click", function (event) {
    if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
        profileMenu.classList.remove("active");
    }
});

// ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
document.querySelectorAll('.profile-menu li').forEach(item => {
    item.addEventListener('click', function () {
        const targetPage = this.getAttribute('data-link');
        window.location.href = targetPage;
    });
});
//ì´ìŠˆ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ
document.querySelector('.add-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueAdd.jsp';  // ìˆ˜ì •ëœ ê²½ë¡œ
});

// ì´ìŠˆ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
document.querySelector('.delete-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueDelete.jsp';  // ìˆ˜ì •ëœ ê²½ë¡œ
});

// ì´ìŠˆ ì—…ë°ì´íŠ¸ ë²„íŠ¼ í´ë¦­ ì‹œ
document.querySelector('.update-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueUpdate.jsp';  // ìˆ˜ì •ëœ ê²½ë¡œ
});

</script>
