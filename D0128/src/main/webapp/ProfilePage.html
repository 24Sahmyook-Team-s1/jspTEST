<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œí•„ í˜ì´ì§€</title>
    <link rel="stylesheet" href="css/ProfilePage.css">
    <script src="js/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- ğŸ“Œ ìƒë‹¨ë°” -->
    <div class="header">
        <h1>MOLE</h1>
    </div>

    <!-- í”„ë¡œí•„ ì½˜í…ì¸  -->
    <div class="profile-container">
        <!-- í”„ë¡œí•„ ì •ë³´ -->
        <div class="profile-info">
            <div class="profile-picture"></div>
            <h2 id="userName">ì‚¬ìš©ì ì´ë¦„</h2>
            <p id="userEmail">ì´ë©”ì¼</p>
            <button class="edit-profile-btn">í”„ë¡œí•„ ìˆ˜ì •</button>

            <!-- âœ¨ ê°œì¸ì†Œê°œê¸€ ë¯¸ë¦¬ë³´ê¸° ê³µê°„ -->
            <div class="bio-preview" id="bioPreview">ì—¬ê¸°ì— ì†Œê°œê¸€ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>

        <!-- ê°œì¸ ì†Œê°œê¸€ê³¼ Pinned í”„ë¡œì íŠ¸ -->
        <div class="sections-row">
            <div class="bio-section">
                <p>ê°œì¸ì†Œê°œê¸€ ì“¸ìˆ˜ìˆëŠ” ì°½</p>
            </div>

            <div class="pinned-section">
                <h3>Pinned <span class="customize">customize</span></h3>
                <div id="pinnedProjects" class="pinned-projects"></div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ -->
    <div class="profile-menu-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
                <li data-link="MainPage.html">í™ˆ</li>
                <li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
                <li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
                <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
                <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
                <li data-link="SettingsPage.html">ì„¤ì •</li>
            </ul>
        </div>
    </div>

    <script src="js/core.js"></script>
</body>
</html>

<script>
$(document).ready(function () {
    // í”„ë¡œí•„ ë©”ë‰´ í† ê¸€
    $("#profileBtn").click(function () {
        $("#profileMenu").toggleClass("active");
    });

    // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    $(document).click(function (event) {
        if (!$(event.target).closest('#profileBtn, #profileMenu').length) {
            $("#profileMenu").removeClass("active");
        }
    });

    // ë©”ë‰´ í•­ëª© í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
    $(".profile-menu li").click(function () {
        window.location.href = $(this).data("link");
    });

    // ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    $.ajax({
        url: "jsp/GetUserProfile.jsp",
        method: "GET",
        dataType: "json",
        success: function (data) {
            $("#userName").text(data.name);
            $("#userEmail").text(data.email);
        },
        error: function () {
            console.error("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    });

    // í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
    $.ajax({
        url: "jsp/GetProjectList.jsp",
        method: "GET",
        dataType: "json",
        success: function (projects) {
            projects.forEach(function (project) {
                $("#pinnedProjects").append(`
                    <div class="pinned-project">${project.name}</div>
                `);
            });
        },
        error: function () {
            console.error("í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    });

    // ì†Œê°œê¸€ ì…ë ¥ ì‹œ ì˜¤ë¥¸ìª½ì— ì‹¤ì‹œê°„ ë°˜ì˜
    $(".bio-section p").attr("contenteditable", "true");  // ì†Œê°œê¸€ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
    $(".bio-section p").on("input", function () {
        const bioContent = $(this).text();
        if (bioContent.trim() !== "") {
            $("#bioPreview").addClass("active").text(bioContent);
        } else {
            $("#bioPreview").removeClass("active").text("ì—¬ê¸°ì— ì†Œê°œê¸€ì´ í‘œì‹œë©ë‹ˆë‹¤.");
        }
    });
});

</script>
