<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ€ ì°¾ê¸°</title>
    <link rel="stylesheet" href="css/TeamPage.css">
</head>
<body>

    <!-- ğŸ“Œ ìƒë‹¨ë°” -->
    <div class="header">
        <h1>MOLE - íŒ€ ì°¾ê¸°</h1>
    </div>

    <div class="container">
        <!-- ğŸ“Œ ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <ul>
                <li onclick="goToPage('TeamPage.html')">ëŒì•„ê°€ê¸°</li>
            </ul>
        </div>

        <div class="main-content">
            <h2>íŒ€ ëª©ë¡</h2>
            <input type="text" id="searchTeam" placeholder="íŒ€ ì´ë¦„ ê²€ìƒ‰...">
            <div class="team-list" id="teamList">
                <!-- âœ… ì—¬ê¸°ì— DBì—ì„œ ê°€ì ¸ì˜¨ íŒ€ ëª©ë¡ì´ í‘œì‹œë¨ -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const teamList = document.getElementById("teamList");
            const searchInput = document.getElementById("searchTeam");

            function fetchTeams() {
                fetch("jsp/GetTeamList.jsp")
                    .then(response => response.json())
                    .then(teams => {
                        renderTeams(teams);
                    })
                    .catch(error => console.error("íŒ€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", error));
            }

            function renderTeams(teams, filter = "") {
                teamList.innerHTML = "";
                teams
                    .filter(team => team.name.includes(filter))
                    .forEach(team => {
                        let div = document.createElement("div");
                        div.classList.add("team-card");
                        div.innerHTML = `
                            <strong>${team.name}</strong> <br>
                            ìƒì„± ë‚ ì§œ: ${team.created_at} <br>
                            <button onclick="joinTeam(${team.id}, '${team.name}')">ì°¸ì—¬</button>
                        `;
                        teamList.appendChild(div);
                    });
            }

            searchInput.addEventListener("input", function () {
                fetch("jsp/GetTeamList.jsp")
                    .then(response => response.json())
                    .then(teams => {
                        renderTeams(teams, this.value);
                    });
            });

            window.joinTeam = function (teamId, teamName) {
                if (confirm(`"${teamName}" íŒ€ì— ì°¸ì—¬ ì‹ ì²­ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    fetch("jsp/JoinTeam.jsp", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `teamId=${teamId}`
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                    })
                    .catch(error => console.error("íŒ€ ì°¸ì—¬ ìš”ì²­ ì‹¤íŒ¨:", error));
                }
            };

            fetchTeams();
        });
    </script>

</body>
</html>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const teamList = document.getElementById("teamList");

    function fetchTeams() {
        fetch("jsp/GetTeamList.jsp")
            .then(response => response.json())
            .then(teams => {
                renderTeams(teams);
            })
            .catch(error => console.error("íŒ€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", error));
    }

    function renderTeams(teams) {
        teamList.innerHTML = "";
        teams.forEach(team => {
            let div = document.createElement("div");
            div.classList.add("team-card");
            div.innerHTML = `
                <strong>${team.name}</strong> <br>
                ìƒì„± ë‚ ì§œ: ${team.created_at} <br>
                <button onclick="joinTeam(${team.id})">ì°¸ì—¬</button>  <!-- âœ… team.id ì „ë‹¬ -->
            `;
            teamList.appendChild(div);
        });
    }

    window.joinTeam = function (teamId) {
        if (confirm(`ì´ íŒ€ì— ì°¸ì—¬ ì‹ ì²­ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            fetch("jsp/JoinTeam.jsp", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `teamId=${teamId}`
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("íŒ€ ì°¸ì—¬ ìš”ì²­ ì‹¤íŒ¨:", error));
        }
    };

    fetchTeams();
});
</script>
