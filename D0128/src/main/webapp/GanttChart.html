<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOLE - Gantt Chart</title>
    <link rel="stylesheet" href="css/GanttChart.css">
    <script src="js/jquery-3.6.0.min.js"></script>
</head>
<body>

    <!-- ğŸ“Œ ìƒë‹¨ë°” -->
    <div class="header">
        <h1>MOLE</h1>
    </div>

    <div class="container">
        <!-- ğŸ“Œ ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <ul>
                <li class="sidebar-link" data-link="MainPage.html">ëŒ€ì‹œë³´ë“œ</li>
                <li class="sidebar-link" data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li>
                <li class="sidebar-link" data-link="GanttChart.html">ê°„íŠ¸ ì°¨íŠ¸</li>
                <li class="sidebar-link" data-link="IssuePage.html">ì´ìŠˆ</li>
                <li class="sidebar-link" data-link="TeamBoard.html">íŒ€ ë³´ë“œ</li>
            </ul>
        </div>

        <!-- ğŸ“Œ ë©”ì¸ ì»¨í…ì¸  (ê°„íŠ¸ì°¨íŠ¸) -->
        <div class="main-content">
            <h2>Gantt Chart</h2>
            <div class="gantt-chart-container">
                <div class="gantt-chart">
                    <div class="gantt-header">
                        <div class="gantt-project-name">Project</div>
                        <div class="gantt-days">
                            <div>ì›”</div>
                            <div>í™”</div>
                            <div>ìˆ˜</div>
                            <div>ëª©</div>
                            <div>ê¸ˆ</div>
                        </div>
                    </div>
                    <div class="gantt-body" id="ganttBody">
                        <!-- JavaScriptë¡œ í”„ë¡œì íŠ¸ì™€ ì§„í–‰ë„ë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ğŸ“Œ ìŠ¤ì¼€ì¤„ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <h3>í”„ë¡œì íŠ¸ ìŠ¤ì¼€ì¤„ ìˆ˜ì •</h3>
            <form id="scheduleForm">
                <input type="hidden" id="projectId" name="projectId">
                <label><input type="checkbox" name="monday"> ì›”ìš”ì¼</label>
                <label><input type="checkbox" name="tuesday"> í™”ìš”ì¼</label>
                <label><input type="checkbox" name="wednesday"> ìˆ˜ìš”ì¼</label>
                <label><input type="checkbox" name="thursday"> ëª©ìš”ì¼</label>
                <label><input type="checkbox" name="friday"> ê¸ˆìš”ì¼</label>
                <button type="submit">ì €ì¥</button>
                <button type="button" class="close">ë‹«ê¸°</button>
            </form>
        </div>
    </div>
    <!-- ğŸ“Œ í”„ë¡œí•„ ë©”ë‰´ (ì˜¤ë¥¸ìª½ í•˜ë‹¨ ìœ„ì¹˜) -->
    <div class="profile-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
				<li data-link="MainPage.html">í™ˆ</li>
                <li data-link="TeamPage.html">íŒ€ í˜ì´ì§€</li> <!-- âœ… íŒ€ í˜ì´ì§€ ì¶”ê°€ -->
                <li data-link="FindTeam.html">íŒ€ ì°¾ê¸°</li>
                <li data-link="CreateTeam.html">íŒ€ ë§Œë“¤ê¸°</li>
                <li data-link="TeamManage.html">íŒ€ ê´€ë¦¬</li>
                <li data-link="ProfilePage.html">í”„ë¡œí•„</li>
                <li data-link="SettingsPage.html">ì„¤ì •</li> </ul>
        </div>
    </div>

    <script>
    $(document).ready(function () {
    	let projectId;
        let userId;
        
        $.ajax({
            url: "jsp/session.jsp",
            type: "GET",
            success: function(response) {
                if (response.includes("ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")) {
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    window.location.href = "index.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                }
                else{
                	userId = response; // ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì IDë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„
                	console.log("ìœ ì € id: " + userId);
                	$.ajax({
                        url: "jsp/projectsession.jsp",
                        type: "GET",
                        success: function(response) {
                            if (response.includes("error")) {
                                alert("í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œê³¨ë¼ ì£¼ì„¸ìš”.");
                                window.location.href = "MainPage.html"; // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
                            }
                            else{
                            	projectId = response; // ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì IDë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„
                                console.log("í”„ë¡œì íŠ¸ id: " + projectId);
                                loadGanttChart();
                                console.log("í˜ì´ì§€ ë¡œë“œ + ìœ ì € id, í”„ë¡œì íŠ¸ id ì™„ë£Œ");
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error("ì„¸ì…˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                        }
                    });
                    console.log("í˜ì´ì§€ ë¡œë“œ + ìœ ì € id, í”„ë¡œì íŠ¸ id ì™„ë£Œ");
                }
            },
            error: function(xhr, status, error) {
                console.error("ì„¸ì…˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        });
        // ğŸ“Œ ì‚¬ì´ë“œë°” ë° í”„ë¡œí•„ ë©”ë‰´ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
        $(".sidebar-link, .profile-menu li").on("click", function () {
            const targetPage = $(this).data("link");
            window.location.href = targetPage;
        });

        // ğŸ“Œ í”„ë¡œí•„ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ë‰´ í† ê¸€
        const profileBtn = $("#profileBtn");
        const profileMenu = $("#profileMenu");

        profileBtn.on("click", function (event) {
            event.stopPropagation();
            profileMenu.toggleClass("active");
        });

        $(document).on("click", function (event) {
            if (!profileBtn.is(event.target) && !profileMenu.is(event.target) && profileMenu.has(event.target).length === 0) {
                profileMenu.removeClass("active");
            }
        });

        // ğŸ“Œ ê°„íŠ¸ ì°¨íŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        loadGanttChart();

        function loadGanttChart() {
            $.ajax({
                url: "jsp/GetTasks.jsp",
                type: "GET",
                dataType: "json",
                success: function (projects) {
                    console.log("âœ… ê°„íŠ¸ ì°¨íŠ¸ ë°ì´í„° ìˆ˜ì‹ :", projects);
                    renderGanttChart(projects);
                },
                error: function (xhr, status, error) {
                    console.error("âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
                }
            });
        }

     // ğŸ“Œ ê°„íŠ¸ ì°¨íŠ¸ ë Œë”ë§ ë° í´ë¦­ ì´ë²¤íŠ¸
        function renderGanttChart(projects) {
            const ganttBody = $("#ganttBody").empty();
            projects.forEach(project => {
                const row = `
                    <div class="gantt-row" data-id="${project.id}">
                        <div class="project-name">${project.taskName}</div>
                        <div class="gantt-progress">
                            <div class="${project.ScheduleMonday === 'Y' ? 'active' : ''}"></div>
                            <div class="${project.ScheduleTuesday === 'Y' ? 'active' : ''}"></div>
                            <div class="${project.ScheduleWednesday === 'Y' ? 'active' : ''}"></div>
                            <div class="${project.ScheduleThursday === 'Y' ? 'active' : ''}"></div>
                            <div class="${project.ScheduleFriday === 'Y' ? 'active' : ''}"></div>
                        </div>
                    </div>
                `;
                ganttBody.append(row);
            });

            // ğŸ“Œ í”„ë¡œì íŠ¸ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
            $(".gantt-row").on("click", function () {
                const projectId = $(this).data("id");
                $("#projectId").val(projectId);
                $("#scheduleModal").show();
            });
        }

        // ğŸ“Œ ìŠ¤ì¼€ì¤„ ì €ì¥
        $("#scheduleForm").on("submit", function (e) {
            e.preventDefault();
            const formData = $(this).serialize();

            $.post("jsp/UpdateProjectSchedule.jsp", formData, function (response) {
                alert("ìŠ¤ì¼€ì¤„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                $("#scheduleModal").hide();
                loadGanttChart();  // ë°ì´í„° ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
            }).fail(function () {
                alert("ìŠ¤ì¼€ì¤„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
        });

        // ğŸ“Œ ëª¨ë‹¬ ë‹«ê¸°
        $(".close").on("click", function () {
            $("#scheduleModal").hide();
        });
    });
    </script>

</body>
</html>